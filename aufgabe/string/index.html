<!doctype html>

<html>

  <head>
    <meta charset="utf-8">
    <title>WASM memory test</title>
  </head>

  <body>
    <script>
     
      
      const memory = new WebAssembly.Memory({ initial: 1,   maximum: 1   });       
 
      WebAssembly.instantiateStreaming(fetch("to-upper.wasm"), { js: { mem: memory } }) // pass memory to web assembly  
      .then(obj => {
        const value = "Hello World";
     
        const uInt8Array = new Uint8Array(memory.buffer);
        const stringEncoded = new TextEncoder().encodeInto(value, uInt8Array);
        const test =  new TextDecoder().decode(uInt8Array)

        const ptr = 0; 
        const count = value.length;

        obj.instance.exports.upper(0, count);

        const result = new TextDecoder().decode(memory.buffer.slice(ptr, count))
        
        console.log(result);
      });
    </script>
  </body>

</html